<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
 <head>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather">
  <link href="/styles/cf08ab1aa727/styles.css" rel="stylesheet">
  <title>SEO improvements on my Blog Generator | Teoten's blog</title>
  <meta name="description" content="Writting XML and JSON for a static site using Clojure">
  <link rel="canonical" href="https://blog.teoten.com/posts/2025/seo_improvements_on_my_blog_generator/">
  <script type="application/ld+json">{"description":"Writting XML and JSON for a static site using Clojure","headline":"SEO improvements on my Blog Generator","@context":"https://schema.org","publisher":{"@type":"Person","name":"teoten"},"articleSection":"Programming","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.teoten.com/posts/2025/seo_improvements_on_my_blog_generator/"},"datePublished":"2025-01-29T08:00:00+01:00","keywords":"clojure","author":{"@type":"Person","name":"Manuel Teodoro Tenango","url":"https://resume.teoten.com/","sameAs":["https://social.linux.pizza/@teoten","https://www.youtube.com/@teoten.programando"]},"dateModified":"2025-01-29T08:00:00+01:00","inLanguage":"en","image":"https://blog.teoten.com/img/seo.jpg","isPartOf":{"@type":"Blog","name":"Teoten's Blog","url":"https://blog.teoten.com"},"@type":"BlogPosting","about":[{"name":"clojure","@type":"Thing"},{"name":"web-dev","@type":"Thing"}]}</script>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Teoten">
 </head>
 <body>
  <!-- Top nav bar -->
  <div>
   <!-- Toggle Button -->
   <button id="theme-toggle-btn" onclick="toggleTheme()"><i class="fas fa-sun"></i></button>
   <div id="wrapper">
    <nav id="navbar" class="navbar">
     <div class="navbar-container">
      <input type="checkbox" name="" id="">
      <div class="hamburger-lines">
       <span class="line line1"></span> <span class="line line2"></span> <span class="line line3"></span>
      </div>
      <ul class="menu-items">
       <li><a href="https://blog.teoten.com/">Home</a></li>
       <li><a href="https://blog.teoten.com/list/">Posts</a></li>
       <li><a href="https://blog.teoten.com/categories/">Categories</a></li>
       <li><a href="https://blog.teoten.com/tags/">Tags</a></li>
       <li><a href="https://blog.teoten.com/about/">About</a></li>
      </ul>
     </div>
    </nav>
   </div>
  </div>
  <div id="shadow-block">
   <div id="container">
    <div id="wide-content">
     <!-- Main content -->
     <div class="article-top">
      <img src="https://blog.teoten.com/img/seo.jpg" class="article-top-image" alt="SEO improvements on my Blog Generator">
      <div class="article-title-container">
       <h1 class="article-title">SEO improvements on my Blog Generator</h1>
      </div>
      <div class="article-meta">
       <span> <i class="fa fa-calendar"> 2025-01-29</i> </span>
      </div>
     </div>
     <article id="post-/posts/2025/seo_improvements_on_my_blog_generator/" data-post-id="/posts/2025/seo_improvements_on_my_blog_generator/">
      <div>
       <span> </span>
       <p><span>For the last couple of weeks I have been working on many improvements to my blog, mainly SEO and the creation of pages to list posts by both, categories and tags. A couple of months ago I wrote a post about <a href="https://blog.teoten.com/posts/2024/building_my_blog_from_scratch">how I built my blog from scratch</a> coding my own site generator in Clojure and mentioned that, although it's been hard work, I have been enjoying it a lot. I also mentioned that it gives me full control on the changes, improvements and optimizations that I want to do. And the work for the last couple of weeks definitely showed that. </span></p>
       <p><span>It was very easy to add a bunch of SEO optimizations for the pages, such as metadata, descriptions and others by simply including the right html code in the right templates. Then, my current generator that uses <a href="https://github.com/yogthos/Selmer">Selmer</a> does automatically the rest. </span></p>
       <p><span>The creation of new pages for Categories and Tags was a bit of extra work, but since it was functional programming in Clojure, I enjoyed it a lot. I basically do some iterations over my metadata, which is in the form of maps, to extract the lists of both, categories and tags, which I use to create the lists in the corresponding pages. Then I filter all the posts by each category (or tag), and include the metadata in the lists of posts for the given category. All that took only 4 new functions, 2 of them simple 2-liners, one to wrap the filtering and the other to generate the map structure to be passed to <code>selmer</code>. </span></p>
       <p><span>But the part that I enjoyed the most and that I want to share in this post was the generation of a <code>sitemap.xml</code> and a <code>JSON-LD</code> schema to help search engines understand the content of my pages. </span></p>
       <h2 class="article-header">A whole website as data</h2><span><span> </span></span>
       <p><span>One of the key messages I have learned from <a href="https://www.rickhickey.com/">Rick Hickey</a> is that everything is data. That i the reason why Clojure includes the data structure called <a href="https://clojure.org/guides/learn/hashed_colls#_maps">maps</a>. </span></p>
       <p><span><em>Maps are commonly used for two purposes - to manage an association of keys to values and to represent domain application data. The first use case is often referred to as dictionaries or hash maps in other languages.</em> </span></p>
       <p>So, I basically keep all the info about each of my posts as a map. The pipeline goes like this:</p>
       <p>1. I write a post either in markdown or org-mode.</p>
       <p>2. Each format is parsed by the corresponding functions using the corresponding libraries.</p>
       <p>3. The information generates a map.</p>
       <p>4. The map of each post goes to an atom that collects all maps.</p>
       <p><span>5. The atom is used by different elements to render pages (i.e., <code>stasis</code>), pass data (i.e., <code>selmer</code>) and other functions. </span></p>
       <p>The map goes more or less like this:</p>
       <pre><code class="highlight"><span></span><span class="p">(</span><span class="k">def </span><span class="nv">posts-map</span>
  <span class="s">"Vector of maps, one map per content element. Each containing the following:</span>
<span class="s">  `:id` Identifier, thus, relative path.</span>
<span class="s">  `:metadata` All the metadata from yml in md or metadata in org</span>
<span class="s">  files. In html takes yml as the first paragraph.</span>
<span class="s">  `:head` If an html `` section exists, its content is stored here.</span>
<span class="s">  `:body` The hmlt `` section.</span>
<span class="s">  `:path` Relative path to the file -&gt; website.</span>
<span class="s">  `:format` of the source file.</span>
<span class="s">  "</span>
  <span class="p">(</span><span class="nf">atom</span> <span class="p">[]))</span>
</code></pre><span> </span>
       <p>As for the metadata, it depends on the specific post, but it usually has a structure like the following:</p>
       <ul>
        <li>
         <p>author</p></li>
        <li>
         <p>title</p></li>
        <li>
         <p>description</p></li>
        <li>
         <p>image: The path, either relative to the images folders or to the position of the post file. I have a function to normalize this to the url path.</p></li>
        <li>
         <p>draft: Boolean to decide if it should be rendered or not.</p></li>
        <li>
         <p><span>date: Publication date in the format <code>%Y-%m-%d</code>. </span></p></li>
        <li>
         <p>updated: If it's been updated, the date.</p></li>
        <li>
         <p>tags: Strings inside a clojure vector. For markdown, they have to be comma separated (YAML).</p></li>
        <li>
         <p>categories: Same as tags, but for categories.</p></li>
       </ul>
       <p><span>It goes without saying that having maps like this has a lot of benefits for my workflow. Among other things, I use it to generate <code>xml</code> and <code>json</code> formatted data about the content. </span></p>
       <h2 class="article-header">Generating a sitemap.xml</h2><span> </span>
       <p><span>Generating <code>xml</code> is extremely simple using the <code>data.xml</code> library from Clojure: </span></p>
       <pre><code class="highlight"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">teoten.ttblog.content.rss</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">clojure.data.xml</span> <span class="ss">:as</span> <span class="nv">xml</span><span class="p">]</span>
   <span class="p">[</span><span class="nv">clj-time.coerce</span> <span class="ss">:as</span> <span class="nv">coerce</span><span class="p">]))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">sitemap-element</span> <span class="p">[</span><span class="nv">post</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">base-url</span> <span class="p">(</span><span class="nf">get-base-url</span><span class="p">)</span>
        <span class="nb">path </span><span class="p">(</span><span class="nb">str </span><span class="nv">base-url</span> <span class="p">(</span><span class="ss">:path</span> <span class="nv">post</span><span class="p">))]</span>
    <span class="p">[</span><span class="ss">:url</span>
     <span class="p">[</span><span class="ss">:loc</span> <span class="nv">path</span><span class="p">]</span>
     <span class="p">[</span><span class="ss">:lastmod</span> <span class="p">(</span><span class="nf">get-in</span> <span class="nv">post</span> <span class="p">[</span><span class="ss">:metadata</span> <span class="ss">:date</span><span class="p">])]]))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">sitemap-xml</span> <span class="p">[</span><span class="nv">posts</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">base-url</span> <span class="p">(</span><span class="nf">get-base-url</span><span class="p">)</span>
        <span class="nv">sorted-posts</span> <span class="p">(</span><span class="nb">sort-by </span><span class="o">#</span><span class="p">(</span><span class="nf">get-in</span> <span class="nv">%</span> <span class="p">[</span><span class="ss">:metadata</span> <span class="ss">:date</span><span class="p">])</span> <span class="o">#</span><span class="p">(</span><span class="nf">compare</span> <span class="nv">%2</span> <span class="nv">%1</span><span class="p">)</span> <span class="nv">posts</span><span class="p">)]</span>
    <span class="p">(</span><span class="nf">xml/emit-str</span>
     <span class="p">(</span><span class="nf">xml/sexp-as-element</span>
      <span class="p">[</span><span class="ss">:urlset</span> <span class="p">{</span><span class="ss">:xmlns</span> <span class="s">"http://www.sitemaps.org/schemas/sitemap/0.9"</span><span class="p">}</span>
       <span class="p">(</span><span class="nb">map </span><span class="nv">sitemap-element</span> <span class="nv">sorted-posts</span><span class="p">)]))))</span>
</code></pre><span> </span>
       <p><span>Basically, a Clojure map with the required fields. Then it uses <code>xml/emit-str</code> to emit the element to string, and <code>xml/sexp-as-element</code> to convert a single sexp into an element. So, something like <code>[:lastmod "2024-01-01]</code> is converted to its xml version <code><lastmod>
           2024-01-01
          </lastmod></code>. </span></p>
       <p><span>The <code>get-base-url</code> function extracts the base URL from my app, which can be either the localhost on server mode, or my blog url. But for the sitemap it can as well be replaced for a hardcoded path, although in this way is easier to change from the configuration file if I ever change the domain of my blog. </span></p>
       <p><span>Another little detail is that my name space is called <code>teoten.ttblog.content.rss</code> because the rest of the code (which was originally placed in this script) is used to generate the <code>rss</code> xml file. Probably I should rename it to <code>teoten.ttblog.content.xml</code>. </span></p>
       <p><span>But I think that everybody would agree that this is a very simple and easy way to generate a <code>sitemap.xml</code> string. Then is simply rendered and merged with the other pages with <code>stasis/merge-page-sources</code>. </span></p>
       <h2 class="article-header">Generating a schema using JSON-LD format</h2><span> </span>
       <p>The JSON-LD schema was a bit more complicated and thus, a bit more fun to code. The final result should look like this:</p>
       <pre><code class="highlight"><span></span><span class="p">{</span>
  <span class="nt">"description"</span><span class="p">:</span><span class="s2">"POST'S DESCRIPTION"</span><span class="p">,</span>
  <span class="nt">"headline"</span><span class="p">:</span><span class="s2">"POST'S TITLE"</span><span class="p">,</span>
  <span class="nt">"@context"</span><span class="p">:</span><span class="s2">"https://schema.org"</span><span class="p">,</span>
  <span class="nt">"publisher"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"@type"</span><span class="p">:</span><span class="s2">"Person"</span><span class="p">,</span>
    <span class="nt">"name"</span><span class="p">:</span><span class="s2">"NAME"</span><span class="p">},</span>
  <span class="nt">"articleSection"</span><span class="p">:</span><span class="s2">"Programming"</span><span class="p">,</span>
  <span class="nt">"mainEntityOfPage"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"@type"</span><span class="p">:</span><span class="s2">"WebPage"</span><span class="p">,</span>
    <span class="nt">"@id"</span><span class="p">:</span><span class="s2">"CANNONICAL PATH OF THE POST"</span><span class="p">},</span>
  <span class="nt">"datePublished"</span><span class="p">:</span><span class="s2">"DATE IN FORMAT 2024-01-01T08:00:00+02:00"</span><span class="p">,</span>
  <span class="nt">"keywords"</span><span class="p">:</span><span class="s2">"KEYWORDS AS SINGLE STRING, COMMA SEPPARATED"</span><span class="p">,</span>
  <span class="nt">"author"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"@type"</span><span class="p">:</span><span class="s2">"Person"</span><span class="p">,</span>
    <span class="nt">"name"</span><span class="p">:</span><span class="s2">"NAME"</span><span class="p">,</span>
    <span class="nt">"url"</span><span class="p">:</span><span class="s2">"PERSONAL URL"</span><span class="p">,</span>
    <span class="nt">"sameAs"</span><span class="p">:[</span>
      <span class="s2">"LINK TO PERSONAL i.e., LINKEDIN"</span><span class="p">,</span>
      <span class="s2">"MORE LINKS TO SOCIALS"</span><span class="p">]},</span>
  <span class="nt">"dateModified"</span><span class="p">:</span><span class="s2">"LAST MODIFIED DATE"</span><span class="p">,</span>
  <span class="nt">"inLanguage"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span>
  <span class="nt">"image"</span><span class="p">:</span><span class="s2">"CANNONICAL PATH TO THE IMAGE"</span><span class="p">,</span>
  <span class="nt">"isPartOf"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"@type"</span><span class="p">:</span><span class="s2">"Blog"</span><span class="p">,</span>
    <span class="nt">"name"</span><span class="p">:</span><span class="s2">"BLOG'S NAME"</span><span class="p">,</span>
    <span class="nt">"url"</span><span class="p">:</span><span class="s2">"BLOG'S URL"</span><span class="p">},</span>
  <span class="nt">"@type"</span><span class="p">:</span><span class="s2">"BlogPosting"</span><span class="p">,</span>
  <span class="nt">"about"</span><span class="p">:[{</span>
    <span class="nt">"name"</span><span class="p">:</span><span class="s2">"CATEGORY 1"</span><span class="p">,</span>
    <span class="nt">"@type"</span><span class="p">:</span><span class="s2">"Thing"</span><span class="p">}]</span>
<span class="p">}</span>
</code></pre><span> </span>
       <p><span>If you are not familiar with it (I wasn't), you can see the JSON string for this very post (or any in this blog) by right clicking on the page, <code>Inspect</code>, find the <code>Element</code> with the html code, expand the <code></code> section to find a <code>script</code> tag with JSON code in it. </span></p>
       <p><span>I guess it goes without saying that the task was to generate a Clojure map with such structure. Then I used <code>[cheshire.core :as json]</code> to parse it to a JSON string. Here is the code: </span></p>
       <pre><code class="highlight"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">format-google-datetime</span>
  <span class="s">"Converts a date string in 'yyyy-MM-dd' format to Google's datetime</span>
<span class="s">  format 'yyyy-MM-ddTHH:mm:ss+HH:mm', accounting for Warsaw's time</span>
<span class="s">  zone."</span>
  <span class="p">[</span><span class="nv">date-str</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">local-date</span> <span class="p">(</span><span class="nf">LocalDate/parse</span> <span class="nv">date-str</span><span class="p">)</span>
        <span class="nv">zoned-date-time</span> <span class="p">(</span><span class="nf">ZonedDateTime/of</span> <span class="nv">local-date</span> <span class="p">(</span><span class="nf">LocalTime/of</span> <span class="mi">8</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">ZoneId/of</span> <span class="s">"Europe/Warsaw"</span><span class="p">))</span>
        <span class="nv">formatter</span> <span class="p">(</span><span class="nf">DateTimeFormatter/ofPattern</span> <span class="s">"yyyy-MM-dd'T'HH:mm:ssXXX"</span><span class="p">)]</span>
    <span class="p">(</span><span class="nf">.format</span> <span class="nv">zoned-date-time</span> <span class="nv">formatter</span><span class="p">)))</span>


<span class="p">(</span><span class="kd">defn </span><span class="nv">normalize-namespaced-keys</span>
    <span class="s">"Converts namespaced keys like :ld/context to @context."</span>
  <span class="p">[</span><span class="nv">clojure-map</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">transform-key</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">k</span><span class="p">]</span>
                        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">keyword? </span><span class="nv">k</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="s">"ld"</span> <span class="p">(</span><span class="nb">namespace </span><span class="nv">k</span><span class="p">)))</span>
                          <span class="p">(</span><span class="nb">str </span><span class="s">"@"</span> <span class="p">(</span><span class="nb">name </span><span class="nv">k</span><span class="p">))</span> <span class="c1">;; Replace :ld/context -&gt; @context</span>
                          <span class="nv">k</span><span class="p">))]</span>
    <span class="p">(</span><span class="nf">clojure.walk/postwalk</span>
     <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">map? </span><span class="nv">x</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">into </span><span class="p">{}</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">k</span> <span class="nv">v</span><span class="p">]]</span> <span class="p">[(</span><span class="nf">transform-key</span> <span class="nv">k</span><span class="p">)</span> <span class="nv">v</span><span class="p">])</span> <span class="nv">x</span><span class="p">))</span>
         <span class="nv">x</span><span class="p">))</span>
     <span class="nv">clojure-map</span><span class="p">)))</span>


<span class="p">(</span><span class="kd">defn </span><span class="nv">schema-to-json-ld</span>
    <span class="s">"Converts a prepared schema map to a JSON-LD string."</span>
  <span class="p">[</span><span class="nv">schema-map</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">json/generate-string</span> <span class="p">(</span><span class="nf">normalize-namespaced-keys</span> <span class="nv">schema-map</span><span class="p">)))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">create-schema-map-from-post-map</span> <span class="p">[</span><span class="nv">post-map</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">metadata</span> <span class="p">(</span><span class="ss">:metadata</span> <span class="nv">post-map</span><span class="p">)</span>
        <span class="nv">base-url</span> <span class="p">(</span><span class="nb">get </span><span class="o">@</span><span class="nv">app-env</span> <span class="ss">:base-url</span> <span class="s">""</span><span class="p">)]</span>
    <span class="p">{</span><span class="ss">:ld/context</span> <span class="s">"https://schema.org"</span>
     <span class="ss">:ld/type</span> <span class="s">"BlogPosting"</span>
     <span class="ss">:articleSection</span> <span class="s">"Programming"</span>
     <span class="ss">:isPartOf</span> <span class="p">{</span><span class="ss">:ld/type</span> <span class="s">"Blog"</span>
                <span class="ss">:name</span> <span class="p">(</span><span class="nb">get </span><span class="o">@</span><span class="nv">app-env</span> <span class="ss">:blog-name</span> <span class="s">""</span><span class="p">)</span>
                <span class="ss">:url</span> <span class="nv">base-url</span><span class="p">}</span>
     <span class="ss">:headline</span> <span class="p">(</span><span class="ss">:title</span> <span class="nv">metadata</span><span class="p">)</span>
     <span class="ss">:datePublished</span> <span class="p">(</span><span class="nf">format-google-datetime</span> <span class="p">(</span><span class="ss">:date</span> <span class="nv">metadata</span><span class="p">))</span>
     <span class="ss">:dateModified</span> <span class="p">(</span><span class="nf">format-google-datetime</span> <span class="p">(</span><span class="nb">get </span><span class="nv">metadata</span> <span class="ss">:modified</span> <span class="p">(</span><span class="ss">:date</span> <span class="nv">metadata</span><span class="p">)))</span>
     <span class="ss">:author</span> <span class="p">{</span><span class="ss">:ld/type</span> <span class="s">"Person"</span>
              <span class="ss">:name</span> <span class="p">(</span><span class="ss">:author</span> <span class="nv">metadata</span><span class="p">)</span>
              <span class="ss">:url</span> <span class="p">(</span><span class="nf">get-in</span> <span class="o">@</span><span class="nv">app-env</span> <span class="p">[</span><span class="ss">:schema-markup</span> <span class="ss">:personal-url</span><span class="p">]</span> <span class="s">""</span><span class="p">)</span>
              <span class="ss">:sameAs</span> <span class="p">(</span><span class="nf">get-in</span> <span class="o">@</span><span class="nv">app-env</span> <span class="p">[</span><span class="ss">:schema-markup</span> <span class="ss">:socials</span><span class="p">]</span> <span class="s">""</span><span class="p">)}</span>
     <span class="ss">:description</span> <span class="p">(</span><span class="nb">get </span><span class="nv">metadata</span> <span class="ss">:description</span> <span class="s">""</span><span class="p">)</span>
     <span class="ss">:keywords</span> <span class="p">(</span><span class="nf">str/join</span> <span class="s">", "</span> <span class="p">(</span><span class="nb">get </span><span class="nv">metadata</span> <span class="ss">:tags</span> <span class="p">[</span><span class="s">"programming"</span> <span class="s">"software"</span><span class="p">]))</span>
     <span class="ss">:mainEntityOfPage</span> <span class="p">{</span><span class="ss">:ld/type</span> <span class="s">"WebPage"</span>
                        <span class="ss">:ld/id</span> <span class="p">(</span><span class="nb">str </span><span class="nv">base-url</span> <span class="p">(</span><span class="ss">:path</span> <span class="nv">post-map</span><span class="p">))}</span>
     <span class="ss">:image</span> <span class="p">(</span><span class="nb">get </span><span class="nv">metadata</span> <span class="ss">:image</span> <span class="s">""</span><span class="p">)</span>
     <span class="ss">:about</span> <span class="p">(</span><span class="nf">vec</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">hash-map </span><span class="ss">:ld/type</span> <span class="s">"Thing"</span> <span class="ss">:name</span> <span class="nv">%</span><span class="p">)</span> <span class="p">(</span><span class="ss">:categories</span> <span class="nv">metadata</span><span class="p">)))</span>
     <span class="ss">:inLanguage</span> <span class="p">(</span><span class="nb">get </span><span class="nv">metadata</span> <span class="ss">:language</span> <span class="s">"en"</span><span class="p">)</span>
     <span class="ss">:publisher</span> <span class="p">{</span><span class="ss">:ld/type</span> <span class="s">"Person"</span>
                 <span class="ss">:name</span> <span class="s">"teoten"</span><span class="p">}}))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">schema-to-html-str</span> <span class="p">[</span><span class="nv">schema-map</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">str </span><span class="s">"{:tag :script, :attrs {:type "</span><span class="sc">\\\"</span><span class="nv">application/ld+json</span><span class="sc">\\\"</span><span class="s">"}, :content ["</span><span class="sc">\"\n</span>       <span class="p">(</span><span class="nf">schema-to-json-ld</span> <span class="nv">schema-map</span><span class="p">)</span><span class="sc">\n</span>       <span class="sc">\"</span><span class="s">"]}"</span><span class="p">))</span>
</code></pre><span><span> </span></span>
       <p>Neat, right?</p>
       <p><span>The function <code>schema-to-json-ld</code> is simply a wrapper to create the json string using <code>chesire</code>, and the <code>schema-to-html-str</code> wraps the resulted json string to the html <code>script</code> tag. The <code>create-schema-map-from-post-map</code> does the main task of creating the map in the right format. It is basically a series of calls to <code>get</code> to extract the right info from a posts map, which later can be mapped to all the posts stored in the atom. </span></p>
       <p><span>The tricky part was to generate the <code>"@element"</code>. I thought of few solutions: </span></p>
       <ul>
        <li>
         <p><span>Create a list of elements that need to be prepended by <code>@</code> and implement it at the parsing step. </span></p></li>
        <li>
         <p><span>Use <code>"@element"</code> instead of keys. </span></p></li>
        <li>
         <p><span>Create namespaced keys which can be parsed to <code>@element</code>. </span></p></li>
       </ul><span> </span>
       <p><span>I wanted to use the most clojurist approach and so, I went for the last option. The function <code>normalize-namespaced-keys</code> helps me to achieve this while keeping only keys in my map. </span></p>
       <p><span>Another tricky part was to generate the right format for the datetime. As I mention above, and according to google and bing standards, it has to be a format like this <code>2024-01-01T08:00:00+02:00</code>. Thus, I crafted <code>format-google-datetime</code> to convert the format from my posts to the format requested. It is basically a wrapper around <code>Java.time</code> functions that I created with the help of AI chats. I hardcoded it for <code>Europe/Warsaw</code> time zone since it is the area where I currently am. But it can be easily changed in the function itself. </span></p>
       <h2 class="article-header">Testing the functions</h2><span><span> </span></span>
       <p>One of the things I hate the most of finding useful functions in blog posts is that often, they are quite difficult to reproduce. Unlike the ones in stackoverflow and other help platforms, where people add reproducible examples, in the blogs and many tutorials (including some books) the functions often depend on other components of the code that are not shown and, often, not shared. Not my case.</p>
       <p>On the other hand, one of the things I like the most about functional programming is that the functions can be tested very easily. No need to create or mock complicated objects with tons of parameters. As I mention above, the only complications are other functions or components from other elements of my app. But in this case, those can easily be mocked as well.</p>
       <p><span>In this case, I just need a map like the <code>posts-map</code> described in the first section of this post. Since all the <code>get</code>'s for <code>@app-env</code> have default values, we can mock it with an empty map. </span></p>
       <p><span>Try it yourself by evaluating my functions and passing a map for <code>posts-map</code>. Something like this should work: </span></p>
       <pre><code class="highlight"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">user</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">cheshire.core</span> <span class="ss">:as</span> <span class="nv">json</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">clojure.data.xml</span> <span class="ss">:as</span> <span class="nv">xml</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">str</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:import</span> <span class="p">[</span><span class="nv">java.time</span> <span class="nv">LocalDate</span> <span class="nv">LocalTime</span> <span class="nv">ZonedDateTime</span> <span class="nv">ZoneId</span><span class="p">]</span>
           <span class="p">[</span><span class="nv">java.time.format</span> <span class="nv">DateTimeFormatter</span><span class="p">]))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">get-base-url</span> <span class="p">[]</span> <span class="s">"https://mocked.site.com"</span><span class="p">)</span>

<span class="p">(</span><span class="k">def </span><span class="nv">app-env</span> <span class="p">(</span><span class="nf">atom</span> <span class="p">{}))</span>

<span class="c1">;; Evaluate the functions or paste them in the REPL.</span>

<span class="c1">;; Mock posts-map</span>
<span class="p">(</span><span class="k">def </span><span class="nv">posts-map</span>
  <span class="p">(</span><span class="nf">atom</span> <span class="p">[{</span><span class="ss">:id</span> <span class="s">"fake_post"</span>
          <span class="ss">:metadata</span> <span class="p">{</span><span class="ss">:author</span> <span class="s">"John Doe"</span>
                     <span class="ss">:title</span> <span class="s">"A fake post"</span>
                     <span class="ss">:image</span> <span class="s">"/img/fake.jpg"</span>
                     <span class="ss">:draft</span> <span class="nv">false</span>
                     <span class="ss">:date</span> <span class="s">"2024-01-01"</span>
                     <span class="ss">:description</span> <span class="s">"Post generated for testing"</span>
                     <span class="ss">:tags</span> <span class="p">[</span><span class="s">"none"</span> <span class="s">"fake"</span><span class="p">]</span>
                     <span class="ss">:categories</span> <span class="p">[</span><span class="s">"test"</span><span class="p">]}</span>
          <span class="ss">:head</span> <span class="s">""</span>
          <span class="ss">:body</span> <span class="s">"Minimal content"</span>
          <span class="ss">:path</span> <span class="s">"fake_post"</span>
          <span class="ss">:format</span> <span class="s">"org"</span><span class="p">}]))</span>

<span class="c1">;; Test the functions:</span>
<span class="p">(</span><span class="nf">sitemap-element</span> <span class="p">(</span><span class="nb">first </span><span class="o">@</span><span class="nv">posts-map</span><span class="p">))</span>

<span class="p">(</span><span class="nf">sitemap-xml</span> <span class="o">@</span><span class="nv">posts-map</span><span class="p">)</span>

<span class="p">(</span><span class="nf">format-google-datetime</span> <span class="s">"2024-01-01"</span><span class="p">)</span>

<span class="p">(</span><span class="nf">normalize-namespaced-keys</span> <span class="p">{</span><span class="ss">:key</span> <span class="s">"normal key"</span> <span class="ss">:ld/at</span> <span class="s">"at key"</span><span class="p">})</span>

<span class="p">(</span><span class="nf">create-schema-map-from-post-map</span> <span class="p">(</span><span class="nb">first </span><span class="o">@</span><span class="nv">posts-map</span><span class="p">))</span>

<span class="p">(</span><span class="nf">schema-to-json-ld</span> <span class="p">(</span><span class="nf">create-schema-map-from-post-map</span> <span class="p">(</span><span class="nb">first </span><span class="o">@</span><span class="nv">posts-map</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">schema-to-html-str</span> <span class="p">(</span><span class="nf">create-schema-map-from-post-map</span> <span class="p">(</span><span class="nb">first </span><span class="o">@</span><span class="nv">posts-map</span><span class="p">)))</span>
</code></pre>
       <h2 class="article-header">Conclusions</h2><span> </span>
       <p>Writing my own static site generator engine for my blog has been both, rewarding and fun. It starts showing the advantages of knowing your stack, which makes it much more fun to add elements, or know how exactly you want them. I am not big fan of black boxes were you input personal info and you get some output, not knowing what is there in between. Especially now in the age of surveillance capitalism.</p>
       <p>Also, Clojure really exploits the advantages of functional programming. And coding my own site generator is speeding up my learning process.</p>
       <p>There are still a few improvements to make for my blog, but so far I really like what I have accomplished so far and I'm liking more and more the current state of my blog. By the way, creating the Categories and Tags sections also was an interesting process. I might share it in a future post. Let me know if there is some interest.</p>
       <p>In the meantime, I would also love to hear your opinion about the look and UI of the current state of my blog. Maybe there is more that I can add or change than what is planned. Please, leave us a comment.</p>
      </div>
     </article>
     <div class="article-comments">
      <script src="https://utteranc.es/client.js" repo="teotenn/blog.teoten.com" issue-term="pathname" theme="github-light" crossorigin="anonymous" async>
  </script>
     </div>
    </div>
    <button id="toggle-button">&lt;</button>
    <div id="sidebar" class="collapsed">
     <a href="https://blog.teoten.com/about/"> <img src="https://blog.teoten.com/img/tt-avatar.jpg" alt="Teoten" class="sidebar-image"> </a>
     <h2 class="h-sidebar">Links</h2>
     <ul>
      <li><a href="https://www.r-project.org/">The R Project</a></li>
      <li><a href="https://www.r-bloggers.com/">R-bloggers</a></li>
      <li><a href="https://clojure.org/">Clojure</a></li>
      <li><a href="https://www.gnu.org/software/emacs/">GNU Emacs</a></li>
     </ul>
     <h2 class="h-sidebar">Socials</h2>
     <ul class="horizontal-list">
      <li><a href="https://www.linkedin.com/in/teoten/"><i class="fab fa-linkedin-in"></i></a></li>
      <li><a href="https://codeberg.org/teoten"><i class="fab fa-github"></i></a></li>
      <li><a rel="me" href="https://social.linux.pizza/@teoten"><i class="fab fa-mastodon"></i></a></li>
     </ul>
    </div>
   </div>
  </div>
  <script src="/js/9c70eb7a56f7/scripts.js"></script>
 </body>
</html>